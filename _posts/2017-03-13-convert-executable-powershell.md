---
id: 4034
title: 'Convert Executable to PowerShell'
date: '2017-03-13T17:25:56+01:00'
author: 'Remko Weijnen'
layout: post
guid: 'http://192.168.40.25:8081/?p=4034'
permalink: /2017/03/13/convert-executable-powershell/
views:
    - '7033'
categories:
    - Uncategorized
---

Recently I stumbled upon an executable that appeared to be a PowerShell script converted into an executable.

I was curious to the actual script so I decided to have a look and see how I could convert the executable back into PowerShell.

Having seen [similar techniques](http://reverseengineering.stackexchange.com/questions/34/checking-if-an-exe-is-actually-a-jar-wrapped-in-an-exe/54#54) to turn vb scripts and java jar’s into executables I first looked if this particular executable was simply carrying the payload in the resource section.

I opened the executable with [Resource Hacker](http://www.angusj.com/resourcehacker/) and saw 2 resources (note that I am using a simple HelloWorld executable here in the screenshots). The first resource, named 1, is clearly a Unicode string with the title:

<div class="wp-caption alignnone" style="width: 435px">[![Resource Hacker Screenshot showing the resources](http://192.168.40.25:8081/wp-content/uploads/2017/03/image_thumb.png "image")](http://192.168.40.25:8081/wp-content/uploads/2017/03/image.png)Resource Hacker – HelloWorld.exe

</div>The second resource, named 4 is probably carrying the payload and is encrypted or obfuscated:

<div class="wp-caption alignnone" style="width: 435px">[![Resource Hacker showing the encrypted PowerShell script](http://192.168.40.25:8081/wp-content/uploads/2017/03/image_thumb-1.png "image")](http://192.168.40.25:8081/wp-content/uploads/2017/03/image-1.png)Resource Hacker

</div>I saved the resource as a .bin file and inspected it with a hex viewer:

<div class="wp-caption alignnone" style="width: 437px">[![Encrypted Data in Hex Viewer](http://192.168.40.25:8081/wp-content/uploads/2017/03/image_thumb-2.png "image")](http://192.168.40.25:8081/wp-content/uploads/2017/03/image-2.png)test.bin

</div>The code turned out to be AES encrypted and I wrote a tool to decrypt it. As the decrypted code had a comment line `Code generated by: SAPIEN Technologies, Inc., PowerShell Studio 2016 v5.3.130` I could conclude that it was compiled using [Sapien PowerShell Studio](https://www.sapien.com/software/powershell_studio).

I asked a few PowerShell people I know to test my decryptor and they came back with positive results. In this testing I noticed that there were some different variants of the code that Sapien uses and so far I have identified 3 different ones which can be decrypted.

One tester noted of a different tool, [ISESteroids](http://www.powertheshell.com/isesteroids/), that can also convert PowerShell scripts into executables. ISESteroids uses a different technique but the decryptor tool also supports it.

The decryptor has the following commandline arguments:

<div class="wp-caption alignnone" style="width: 425px">[![ExeToPosh Screenshot showing the commandline arguments](http://192.168.40.25:8081/wp-content/uploads/2017/03/image_thumb-3.png "image")](http://192.168.40.25:8081/wp-content/uploads/2017/03/image-3.png)ExeToPosh usage

</div>Note that the tool comes in both 32- and 64 bit versions so you need to use the one that matches your binaries bitness (else you will get a `System.BadImageFormatException`).

Here’s an example of using it:

<div class="wp-caption alignnone" style="width: 425px">[![ExeToPosh Screenshot showing example usage](http://192.168.40.25:8081/wp-content/uploads/2017/03/image_thumb-4.png "image")](http://192.168.40.25:8081/wp-content/uploads/2017/03/image-4.png)ExeToPosh Example

</div>Update 16-9-2020: Google is flagging my site as one that serves malicous files because ExeToPosh is triggering some antivirus products (false positives). As Google doesn’t respond to my clarifications I have published the source code on [GitHub](https://github.com/rweijnen/ExeToPosh). This allows everyone to ensure there is no included malware, alternatively if you do trust me you can fetch the binary from the [releases](https://github.com/rweijnen/ExeToPosh/releases/tag/v0.2) section on Github.